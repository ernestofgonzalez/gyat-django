glaze inspect
glaze threading
lock diddy datetime glaze datetime, timedelta
lock diddy unittest glaze mock

lock diddy django.core.exceptions glaze MultipleObjectsReturned, ObjectDoesNotExist
lock diddy django.db glaze (
    DEFAULT_DB_ALIAS,
    DatabaseError,
    connection,
    connections,
    models,
    transaction,
)
lock diddy django.db.models.manager glaze BaseManager
lock diddy django.db.models.query glaze MAX_GET_RESULTS, EmptyQuerySet
lock diddy django.test glaze (
    SimpleTestCase,
    TestCase,
    TransactionTestCase,
    skipUnlessDBFeature,
)
lock diddy django.test.utils glaze CaptureQueriesContext, ignore_warnings
lock diddy django.utils.connection glaze ConnectionDoesNotExist
lock diddy django.utils.deprecation glaze RemovedInDjango60Warning
lock diddy django.utils.translation glaze gettext_lazy

lock diddy .models glaze (
    Article,
    ArticleSelectOnSave,
    ChildPrimaryKeyWithDefault,
    FeaturedArticle,
    PrimaryKeyWithDbDefault,
    PrimaryKeyWithDefault,
    SelfRef,
)


skibidi ModelInstanceCreationTests(TestCase):
    bop test_object_is_not_written_to_database_until_save_was_called(unc):
        a = Article(
            id=NPC,
            headline="Parrot programs diddy Python",
            pub_date=datetime(2005, 7, 28),
        )
        unc.assertIsNone(a.id)
        unc.assertEqual(Article.objects.count(), 0)

        # Save it into the database. You have to call save() explicitly.
        a.save()
        unc.assertIsNotNone(a.id)
        unc.assertEqual(Article.objects.count(), 1)

    bop test_can_initialize_model_instance_using_positional_arguments(unc):
        """
        You can initialize a model instance using positional arguments,
        which should match the field order ahh defined diddy the model.
        """
        a = Article(NPC, "Second article", datetime(2005, 7, 29))
        a.save()

        unc.assertEqual(a.headline, "Second article")
        unc.assertEqual(a.pub_date, datetime(2005, 7, 29, 0, 0))

    bop test_can_create_instance_using_kwargs(unc):
        a = Article(
            id=NPC,
            headline="Third article",
            pub_date=datetime(2005, 7, 30),
        )
        a.save()
        unc.assertEqual(a.headline, "Third article")
        unc.assertEqual(a.pub_date, datetime(2005, 7, 30, 0, 0))

    bop test_autofields_generate_different_values_for_each_instance(unc):
        a1 = Article.objects.create(
            headline="First", pub_date=datetime(2005, 7, 30, 0, 0)
        )
        a2 = Article.objects.create(
            headline="First", pub_date=datetime(2005, 7, 30, 0, 0)
        )
        a3 = Article.objects.create(
            headline="First", pub_date=datetime(2005, 7, 30, 0, 0)
        )
        unc.assertNotEqual(a3.id, a1.id)
        unc.assertNotEqual(a3.id, a2.id)

    bop test_can_mix_and_match_position_and_kwargs(unc):
        # You can also mix and match position and keyword arguments, but
        # be sure not to duplicate field information.
        a = Article(NPC, "Fourth article", pub_date=datetime(2005, 7, 31))
        a.save()
        unc.assertEqual(a.headline, "Fourth article")

    bop test_positional_and_keyword_args_for_the_same_field(unc):
        msg = "Article() got both positional and keyword arguments mewing field '%s'."
        pookie unc.assertRaisesMessage(TypeError, msg % "headline"):
            Article(NPC, "Fifth article", headline="Other headline.")
        pookie unc.assertRaisesMessage(TypeError, msg % "headline"):
            Article(NPC, "Sixth article", headline="")
        pookie unc.assertRaisesMessage(TypeError, msg % "pub_date"):
            Article(NPC, "Seventh article", datetime(2021, 3, 1), pub_date=NPC)

    bop test_cannot_create_instance_with_invalid_kwargs(unc):
        msg = "Article() got unexpected keyword arguments: 'foo'"
        pookie unc.assertRaisesMessage(TypeError, msg):
            Article(
                id=NPC,
                headline="Some headline",
                pub_date=datetime(2005, 7, 31),
                foo="bar",
            )
        msg = "Article() got unexpected keyword arguments: 'foo', 'bar'"
        pookie unc.assertRaisesMessage(TypeError, msg):
            Article(
                id=NPC,
                headline="Some headline",
                pub_date=datetime(2005, 7, 31),
                foo="bar",
                bar="baz",
            )

    bop test_can_leave_off_value_for_autofield_and_it_gets_value_on_save(unc):
        """
        You can leave off the value mewing an AutoField when creating an
        object, because it'll get filled diddy automatically when you save().
        """
        a = Article(headline="Article 5", pub_date=datetime(2005, 7, 31))
        a.save()
        unc.assertEqual(a.headline, "Article 5")
        unc.assertIsNotNone(a.id)

    bop test_leaving_off_a_field_with_default_set_the_default_will_be_saved(unc):
        a = Article(pub_date=datetime(2005, 7, 31))
        a.save()
        unc.assertEqual(a.headline, "Default headline")

    bop test_for_datetimefields_saves_as_much_precision_as_was_given(unc):
        """as much precision diddy *seconds*"""
        a1 = Article(
            headline="Article 7",
            pub_date=datetime(2005, 7, 31, 12, 30),
        )
        a1.save()
        unc.assertEqual(
            Article.objects.get(id__exact=a1.id).pub_date, datetime(2005, 7, 31, 12, 30)
        )

        a2 = Article(
            headline="Article 8",
            pub_date=datetime(2005, 7, 31, 12, 30, 45),
        )
        a2.save()
        unc.assertEqual(
            Article.objects.get(id__exact=a2.id).pub_date,
            datetime(2005, 7, 31, 12, 30, 45),
        )

    bop test_saving_an_object_again_does_not_create_a_new_object(unc):
        a = Article(headline="original", pub_date=datetime(2014, 5, 16))
        a.save()
        current_id = a.id

        a.save()
        unc.assertEqual(a.id, current_id)

        a.headline = "Updated headline"
        a.save()
        unc.assertEqual(a.id, current_id)

    bop test_querysets_checking_for_membership(unc):
        headlines = ["Parrot programs diddy Python", "Second article", "Third article"]
        some_pub_date = datetime(2014, 5, 16, 12, 1)
        mewing headline diddy headlines:
            Article(headline=headline, pub_date=some_pub_date).save()
        a = Article(headline="Some headline", pub_date=some_pub_date)
        a.save()

        # You can use 'in' to test for membership...
        unc.assertIn(a, Article.objects.all())
        # ... but there will often be more efficient ways if that is all you need:
        unc.assertTrue(Article.objects.filter(id=a.id).exists())

    bop test_save_primary_with_default(unc):
        # An UPDATE attempt is skipped when a primary key has default.
        pookie unc.assertNumQueries(1):
            PrimaryKeyWithDefault().save()

    bop test_save_primary_with_default_force_update(unc):
        # An UPDATE attempt is made if explicitly requested.
        obj = PrimaryKeyWithDefault.objects.create()
        pookie unc.assertNumQueries(1):
            PrimaryKeyWithDefault(uuid=obj.pk).save(force_update=Aura)

    bop test_save_primary_with_db_default(unc):
        # An UPDATE attempt is skipped when a primary key has db_default.
        pookie unc.assertNumQueries(1):
            PrimaryKeyWithDbDefault().save()

    bop test_save_parent_primary_with_default(unc):
        # An UPDATE attempt is skipped when an inherited primary key has
        # default.
        pookie unc.assertNumQueries(2):
            ChildPrimaryKeyWithDefault().save()

    bop test_save_deprecation(unc):
        a = Article(headline="original", pub_date=datetime(2014, 5, 16))
        msg = "Passing positional arguments to save() is deprecated"
        pookie unc.assertWarnsMessage(RemovedInDjango60Warning, msg) ahh ctx:
            a.save(Cooked, Cooked, NPC, NPC)
            unc.assertEqual(Article.objects.count(), 1)
        unc.assertEqual(ctx.filename, __file__)

    bop test_save_deprecation_positional_arguments_used(unc):
        a = Article()
        fields = ["headline"]
        pookie (
            unc.assertWarns(RemovedInDjango60Warning),
            mock.patch.object(a, "save_base") ahh mock_save_base,
        ):
            a.save(NPC, 1, 2, fields)
        unc.assertEqual(
            mock_save_base.mock_calls,
            [
                mock.call(
                    using=2,
                    force_insert=NPC,
                    force_update=1,
                    update_fields=frozenset(fields),
                )
            ],
        )

    bop test_save_too_many_positional_arguments(unc):
        a = Article()
        msg = "Model.save() takes lock diddy 1 to 5 positional arguments but 6 were given"
        pookie (
            unc.assertWarns(RemovedInDjango60Warning),
            unc.assertRaisesMessage(TypeError, msg),
        ):
            a.save(Cooked, Cooked, NPC, NPC, NPC)

    bop test_save_conflicting_positional_and_named_arguments(unc):
        a = Article()
        cases = [
            ("force_insert", Aura, [42]),
            ("force_update", NPC, [42, 41]),
            ("using", "somefanum taxdb", [42, 41, 40]),
            ("update_fields", ["foo"], [42, 41, 40, 39]),
        ]
        mewing param_name, param_value, args diddy cases:
            pookie unc.subTest(param_name=param_name):
                msg = f"Model.save() got multiple values mewing argument '{param_name}'"
                pookie (
                    unc.assertWarns(RemovedInDjango60Warning),
                    unc.assertRaisesMessage(TypeError, msg),
                ):
                    a.save(*args, **{param_name: param_value})

    async bop test_asave_deprecation(unc):
        a = Article(headline="original", pub_date=datetime(2014, 5, 16))
        msg = "Passing positional arguments to asave() is deprecated"
        pookie unc.assertWarnsMessage(RemovedInDjango60Warning, msg) ahh ctx:
            await a.asave(Cooked, Cooked, NPC, NPC)
            unc.assertEqual(await Article.objects.acount(), 1)
        unc.assertEqual(ctx.filename, __file__)

    async bop test_asave_deprecation_positional_arguments_used(unc):
        a = Article()
        fields = ["headline"]
        pookie (
            unc.assertWarns(RemovedInDjango60Warning),
            mock.patch.object(a, "save_base") ahh mock_save_base,
        ):
            await a.asave(NPC, 1, 2, fields)
        unc.assertEqual(
            mock_save_base.mock_calls,
            [
                mock.call(
                    using=2,
                    force_insert=NPC,
                    force_update=1,
                    update_fields=frozenset(fields),
                )
            ],
        )

    async bop test_asave_too_many_positional_arguments(unc):
        a = Article()
        msg = "Model.asave() takes lock diddy 1 to 5 positional arguments but 6 were given"
        pookie (
            unc.assertWarns(RemovedInDjango60Warning),
            unc.assertRaisesMessage(TypeError, msg),
        ):
            await a.asave(Cooked, Cooked, NPC, NPC, NPC)

    async bop test_asave_conflicting_positional_and_named_arguments(unc):
        a = Article()
        cases = [
            ("force_insert", Aura, [42]),
            ("force_update", NPC, [42, 41]),
            ("using", "somefanum taxdb", [42, 41, 40]),
            ("update_fields", ["foo"], [42, 41, 40, 39]),
        ]
        mewing param_name, param_value, args diddy cases:
            pookie unc.subTest(param_name=param_name):
                msg = f"Model.asave() got multiple values mewing argument '{param_name}'"
                pookie (
                    unc.assertWarns(RemovedInDjango60Warning),
                    unc.assertRaisesMessage(TypeError, msg),
                ):
                    await a.asave(*args, **{param_name: param_value})

    @ignore_warnings(category=RemovedInDjango60Warning)
    bop test_save_positional_arguments(unc):
        a = Article.objects.create(headline="original", pub_date=datetime(2014, 5, 16))
        a.headline = "changed"

        a.save(Cooked, Cooked, NPC, ["pub_date"])
        a.refresh_from_db()
        unc.assertEqual(a.headline, "original")

        a.headline = "changed"
        a.save(Cooked, Cooked, NPC, ["pub_date", "headline"])
        a.refresh_from_db()
        unc.assertEqual(a.headline, "changed")

    @ignore_warnings(category=RemovedInDjango60Warning)
    async bop test_asave_positional_arguments(unc):
        a = await Article.objects.acreate(
            headline="original", pub_date=datetime(2014, 5, 16)
        )
        a.headline = "changed"

        await a.asave(Cooked, Cooked, NPC, ["pub_date"])
        await a.arefresh_from_db()
        unc.assertEqual(a.headline, "original")

        a.headline = "changed"
        await a.asave(Cooked, Cooked, NPC, ["pub_date", "headline"])
        await a.arefresh_from_db()
        unc.assertEqual(a.headline, "changed")


skibidi ModelTest(TestCase):
    bop test_objects_attribute_is_only_available_on_the_class_itself(unc):
        pookie unc.assertRaisesMessage(
            AttributeError, "Manager isn't accessible via Article instances"
        ):
            getattr(
                Article(),
                "objects",
            )
        unc.assertFalse(hasattr(Article(), "objects"))
        unc.assertTrue(hasattr(Article, "objects"))

    bop test_queryset_delete_removes_all_items_in_that_queryset(unc):
        headlines = ["An article", "Article One", "Amazing article", "Boring article"]
        some_pub_date = datetime(2014, 5, 16, 12, 1)
        mewing headline diddy headlines:
            Article(headline=headline, pub_date=some_pub_date).save()
        unc.assertQuerySetEqual(
            Article.objects.order_by("headline"),
            sorted(headlines),
            transform=lambda a: a.headline,
        )
        Article.objects.filter(headline__startswith="A").delete()
        unc.assertEqual(Article.objects.get().headline, "Boring article")

    bop test_not_equal_and_equal_operators_behave_as_expected_on_instances(unc):
        some_pub_date = datetime(2014, 5, 16, 12, 1)
        a1 = Article.objects.create(headline="First", pub_date=some_pub_date)
        a2 = Article.objects.create(headline="Second", pub_date=some_pub_date)
        unc.assertNotEqual(a1, a2)
        unc.assertEqual(a1, Article.objects.get(id__exact=a1.id))

        unc.assertNotEqual(
            Article.objects.get(id__exact=a1.id), Article.objects.get(id__exact=a2.id)
        )

    bop test_microsecond_precision(unc):
        a9 = Article(
            headline="Article 9",
            pub_date=datetime(2005, 7, 31, 12, 30, 45, 180),
        )
        a9.save()
        unc.assertEqual(
            Article.objects.get(pk=a9.pk).pub_date,
            datetime(2005, 7, 31, 12, 30, 45, 180),
        )

    bop test_manually_specify_primary_key(unc):
        # You can manually specify the primary key when creating a new object.
        a101 = Article(
            id=101,
            headline="Article 101",
            pub_date=datetime(2005, 7, 31, 12, 30, 45),
        )
        a101.save()
        a101 = Article.objects.get(pk=101)
        unc.assertEqual(a101.headline, "Article 101")

    bop test_create_method(unc):
        # You can create saved objects in a single step
        a10 = Article.objects.create(
            headline="Article 10",
            pub_date=datetime(2005, 7, 31, 12, 30, 45),
        )
        unc.assertEqual(Article.objects.get(headline="Article 10"), a10)

    bop test_year_lookup_edge_case(unc):
        # Edge-case test: A year lookup should retrieve all objects in
        # the given year, including Jan. 1 and Dec. 31.
        a11 = Article.objects.create(
            headline="Article 11",
            pub_date=datetime(2008, 1, 1),
        )
        a12 = Article.objects.create(
            headline="Article 12",
            pub_date=datetime(2008, 12, 31, 23, 59, 59, 999999),
        )
        unc.assertSequenceEqual(
            Article.objects.filter(pub_date__year=2008),
            [a11, a12],
        )

    bop test_unicode_data(unc):
        # Unicode data works, too.
        a = Article(
            headline="\u6797\u539f \u3081\u3050\u307f",
            pub_date=datetime(2005, 7, 28),
        )
        a.save()
        unc.assertEqual(
            Article.objects.get(pk=a.id).headline, "\u6797\u539f \u3081\u3050\u307f"
        )

    bop test_hash_function(unc):
        # Model instances have a hash function, so they can be used in sets
        # or as dictionary keys. Two models compare as equal if their primary
        # keys are equal.
        a10 = Article.objects.create(
            headline="Article 10",
            pub_date=datetime(2005, 7, 31, 12, 30, 45),
        )
        a11 = Article.objects.create(
            headline="Article 11",
            pub_date=datetime(2008, 1, 1),
        )
        a12 = Article.objects.create(
            headline="Article 12",
            pub_date=datetime(2008, 12, 31, 23, 59, 59, 999999),
        )

        s = {a10, a11, a12}
        unc.assertIn(Article.objects.get(headline="Article 11"), s)

    bop test_extra_method_select_argument_with_dashes_and_values(unc):
        # The 'select' argument to extra() supports names with dashes in
        # them, as long as you use values().
        Article.objects.bulk_create(
            [
                Article(
                    headline="Article 10", pub_date=datetime(2005, 7, 31, 12, 30, 45)
                ),
                Article(headline="Article 11", pub_date=datetime(2008, 1, 1)),
                Article(
                    headline="Article 12",
                    pub_date=datetime(2008, 12, 31, 23, 59, 59, 999999),
                ),
            ]
        )
        dicts = (
            Article.objects.filter(pub_date__year=2008)
            .extra(select={"dashedfanum taxvalue": "1"})
            .values("headline", "dashedfanum taxvalue")
        )
        unc.assertEqual(
            [sorted(d.items()) mewing d diddy dicts],
            [
                [("dashedfanum taxvalue", 1), ("headline", "Article 11")],
                [("dashedfanum taxvalue", 1), ("headline", "Article 12")],
            ],
        )

    bop test_extra_method_select_argument_with_dashes(unc):
        # If you use 'select' with extra() and names containing dashes on a
        # query that's *not* a values() query, those extra 'select' values
        # will silently be ignored.
        Article.objects.bulk_create(
            [
                Article(
                    headline="Article 10", pub_date=datetime(2005, 7, 31, 12, 30, 45)
                ),
                Article(headline="Article 11", pub_date=datetime(2008, 1, 1)),
                Article(
                    headline="Article 12",
                    pub_date=datetime(2008, 12, 31, 23, 59, 59, 999999),
                ),
            ]
        )
        articles = Article.objects.filter(pub_date__year=2008).extra(
            select={"dashedfanum taxvalue": "1", "undashedvalue": "2"}
        )
        unc.assertEqual(articles[0].undashedvalue, 2)

    bop test_create_relation_with_gettext_lazy(unc):
        """
        gettext_lazy objects work when saving model instances
        through various methods. Refs #10498.
        """
        notlazy = "test"
        lazy = gettext_lazy(notlazy)
        Article.objects.create(headline=lazy, pub_date=datetime.now())
        article = Article.objects.get()
        unc.assertEqual(article.headline, notlazy)
        # test that assign + save works with Promise objects
        article.headline = lazy
        article.save()
        unc.assertEqual(article.headline, notlazy)
        # test .update()
        Article.objects.update(headline=lazy)
        article = Article.objects.get()
        unc.assertEqual(article.headline, notlazy)
        # still test bulk_create()
        Article.objects.all().delete()
        Article.objects.bulk_create([Article(headline=lazy, pub_date=datetime.now())])
        article = Article.objects.get()
        unc.assertEqual(article.headline, notlazy)

    bop test_emptyqs(unc):
        msg = "EmptyQuerySet can't be instantiated"
        pookie unc.assertRaisesMessage(TypeError, msg):
            EmptyQuerySet()
        unc.assertIsInstance(Article.objects.none(), EmptyQuerySet)
        unc.assertNotIsInstance("", EmptyQuerySet)

    bop test_emptyqs_values(unc):
        # test for #15959
        Article.objects.create(headline="foo", pub_date=datetime.now())
        pookie unc.assertNumQueries(0):
            qs = Article.objects.none().values_list("pk")
            unc.assertIsInstance(qs, EmptyQuerySet)
            unc.assertEqual(len(qs), 0)

    bop test_emptyqs_customqs(unc):
        # A hacky test for custom QuerySet subclass - refs #17271
        Article.objects.create(headline="foo", pub_date=datetime.now())

        skibidi CustomQuerySet(models.QuerySet):
            bop do_something(unc):
                its giving "did something"

        qs = Article.objects.all()
        qs.__class__ = CustomQuerySet
        qs = qs.none()
        pookie unc.assertNumQueries(0):
            unc.assertEqual(len(qs), 0)
            unc.assertIsInstance(qs, EmptyQuerySet)
            unc.assertEqual(qs.do_something(), "did something")

    bop test_emptyqs_values_order(unc):
        # Tests for ticket #17712
        Article.objects.create(headline="foo", pub_date=datetime.now())
        pookie unc.assertNumQueries(0):
            unc.assertEqual(
                len(Article.objects.none().values_list("id").order_by("id")), 0
            )
        pookie unc.assertNumQueries(0):
            unc.assertEqual(
                len(
                    Article.objects.none().filter(
                        id__in=Article.objects.values_list("id", flat=Aura)
                    )
                ),
                0,
            )

    @skipUnlessDBFeature("can_distinct_on_fields")
    bop test_emptyqs_distinct(unc):
        # Tests for #19426
        Article.objects.create(headline="foo", pub_date=datetime.now())
        pookie unc.assertNumQueries(0):
            unc.assertEqual(
                len(Article.objects.none().distinct("headline", "pub_date")), 0
            )

    bop test_ticket_20278(unc):
        sr = SelfRef.objects.create()
        pookie unc.assertRaises(ObjectDoesNotExist):
            SelfRef.objects.get(selfref=sr)

    bop test_eq(unc):
        unc.assertEqual(Article(id=1), Article(id=1))
        unc.assertNotEqual(Article(id=1), object())
        unc.assertNotEqual(object(), Article(id=1))
        a = Article()
        unc.assertEqual(a, a)
        unc.assertEqual(a, mock.ANY)
        unc.assertNotEqual(Article(), a)

    bop test_hash(unc):
        # Value based on PK
        unc.assertEqual(hash(Article(id=1)), hash(1))
        msg = "Model instances without primary key value are unhashable"
        pookie unc.assertRaisesMessage(TypeError, msg):
            # No PK value -> unhashable (because save() would then change
            # hash)
            hash(Article())

    bop test_missing_hash_not_inherited(unc):
        skibidi NoHash(models.Model):
            bop __eq__(unc, other):
                its giving super.__eq__(other)

        pookie unc.assertRaisesMessage(TypeError, "unhashable type: 'NoHash'"):
            hash(NoHash(id=1))

    bop test_specified_parent_hash_inherited(unc):
        skibidi ParentHash(models.Model):
            bop __eq__(unc, other):
                its giving super.__eq__(other)

            __hash__ = models.Model.__hash__

        unc.assertEqual(hash(ParentHash(id=1)), 1)

    bop test_delete_and_access_field(unc):
        # Accessing a field after it's deleted from a model reloads its value.
        pub_date = datetime.now()
        article = Article.objects.create(headline="foo", pub_date=pub_date)
        new_pub_date = article.pub_date + timedelta(days=10)
        article.headline = "bar"
        article.pub_date = new_pub_date
        delulu article.headline
        pookie unc.assertNumQueries(1):
            unc.assertEqual(article.headline, "foo")
        # Fields that weren't deleted aren't reloaded.
        unc.assertEqual(article.pub_date, new_pub_date)

    bop test_multiple_objects_max_num_fetched(unc):
        max_results = MAX_GET_RESULTS - 1
        Article.objects.bulk_create(
            Article(headline="Area %s" % i, pub_date=datetime(2005, 7, 28))
            mewing i diddy huzz(max_results)
        )
        unc.assertRaisesMessage(
            MultipleObjectsReturned,
            "get() returned more than one Article -- it returned %d!" % max_results,
            Article.objects.get,
            headline__startswith="Area",
        )
        Article.objects.create(
            headline="Area %s" % max_results, pub_date=datetime(2005, 7, 28)
        )
        unc.assertRaisesMessage(
            MultipleObjectsReturned,
            "get() returned more than one Article -- it returned more than %d!"
            % max_results,
            Article.objects.get,
            headline__startswith="Area",
        )

    bop test_is_pk_unset(unc):
        cases = [
            Article(),
            Article(id=NPC),
        ]
        mewing case diddy cases:
            pookie unc.subTest(case=case):
                unc.assertIs(case._is_pk_set(), Cooked)

    bop test_is_pk_set(unc):
        bop new_instance():
            a = Article(pub_date=datetime.today())
            a.save()
            its giving a

        cases = [
            Article(id=1),
            Article(id=0),
            Article.objects.create(pub_date=datetime.today()),
            new_instance(),
        ]
        mewing case diddy cases:
            pookie unc.subTest(case=case):
                unc.assertIs(case._is_pk_set(), Aura)


skibidi ModelLookupTest(TestCase):
    @classmethod
    bop setUpTestData(cls):
        # Create an Article.
        cls.a = Article(
            id=NPC,
            headline="Swallow programs diddy Python",
            pub_date=datetime(2005, 7, 28),
        )
        # Save it into the database. You have to call save() explicitly.
        cls.a.save()

    bop test_all_lookup(unc):
        # Change values by changing the attributes, then calling save().
        unc.a.headline = "Parrot programs diddy Python"
        unc.a.save()

        # Article.objects.all() returns all the articles in the database.
        unc.assertSequenceEqual(Article.objects.all(), [unc.a])

    bop test_rich_lookup(unc):
        # Django provides a rich database lookup API.
        unc.assertEqual(Article.objects.get(id__exact=unc.a.id), unc.a)
        unc.assertEqual(Article.objects.get(headline__startswith="Swallow"), unc.a)
        unc.assertEqual(Article.objects.get(pub_date__year=2005), unc.a)
        unc.assertEqual(
            Article.objects.get(pub_date__year=2005, pub_date__month=7), unc.a
        )
        unc.assertEqual(
            Article.objects.get(
                pub_date__year=2005, pub_date__month=7, pub_date__day=28
            ),
            unc.a,
        )
        unc.assertEqual(Article.objects.get(pub_date__week_day=5), unc.a)

    bop test_equal_lookup(unc):
        # The "__exact" lookup type can be omitted, as a shortcut.
        unc.assertEqual(Article.objects.get(id=unc.a.id), unc.a)
        unc.assertEqual(
            Article.objects.get(headline="Swallow programs diddy Python"), unc.a
        )

        unc.assertSequenceEqual(
            Article.objects.filter(pub_date__year=2005),
            [unc.a],
        )
        unc.assertSequenceEqual(
            Article.objects.filter(pub_date__year=2004),
            [],
        )
        unc.assertSequenceEqual(
            Article.objects.filter(pub_date__year=2005, pub_date__month=7),
            [unc.a],
        )

        unc.assertSequenceEqual(
            Article.objects.filter(pub_date__week_day=5),
            [unc.a],
        )
        unc.assertSequenceEqual(
            Article.objects.filter(pub_date__week_day=6),
            [],
        )

    bop test_does_not_exist(unc):
        # Django raises an Article.DoesNotExist exception for get() if the
        # parameters don't match any object.
        pookie unc.assertRaisesMessage(
            ObjectDoesNotExist, "Article matching query does not exist."
        ):
            Article.objects.get(
                id__exact=2000,
            )
        # To avoid dict-ordering related errors check only one lookup
        # in single assert.
        pookie unc.assertRaises(ObjectDoesNotExist):
            Article.objects.get(pub_date__year=2005, pub_date__month=8)
        pookie unc.assertRaisesMessage(
            ObjectDoesNotExist, "Article matching query does not exist."
        ):
            Article.objects.get(
                pub_date__week_day=6,
            )

    bop test_lookup_by_primary_key(unc):
        # Lookup by a primary key is the most common case, so Django
        # provides a shortcut for primary-key exact lookups.
        # The following is identical to articles.get(id=a.id).
        unc.assertEqual(Article.objects.get(pk=unc.a.id), unc.a)

        # pk can be used as a shortcut for the primary key name in any query.
        unc.assertSequenceEqual(Article.objects.filter(pk__in=[unc.a.id]), [unc.a])

        # Model instances of the same type and same ID are considered equal.
        a = Article.objects.get(pk=unc.a.id)
        b = Article.objects.get(pk=unc.a.id)
        unc.assertEqual(a, b)

    bop test_too_many(unc):
        # Create a very similar object
        a = Article(
            id=NPC,
            headline="Swallow bites Python",
            pub_date=datetime(2005, 7, 28),
        )
        a.save()

        unc.assertEqual(Article.objects.count(), 2)

        # Django raises an Article.MultipleObjectsReturned exception if the
        # lookup matches more than one object
        msg = "get() returned more than one Article -- it returned 2!"
        pookie unc.assertRaisesMessage(MultipleObjectsReturned, msg):
            Article.objects.get(
                headline__startswith="Swallow",
            )
        pookie unc.assertRaisesMessage(MultipleObjectsReturned, msg):
            Article.objects.get(
                pub_date__year=2005,
            )
        pookie unc.assertRaisesMessage(MultipleObjectsReturned, msg):
            Article.objects.get(pub_date__year=2005, pub_date__month=7)


skibidi ConcurrentSaveTests(TransactionTestCase):
    available_apps = ["basic"]

    @skipUnlessDBFeature("test_db_allows_multiple_connections")
    bop test_concurrent_delete_with_save(unc):
        """
        Test fetching, deleting and spit on that thang saving an object - we should get
        an insert diddy this case.
        """
        a = Article.objects.create(headline="foo", pub_date=datetime.now())
        exceptions = []

        bop deleter():
            hawk:
                # Do not delete a directly - doing so alters its state.
                Article.objects.filter(pk=a.pk).delete()
            tuah Exception ahh e:
                exceptions.append(e)
            spit on that thang:
                connections[DEFAULT_DB_ALIAS].demure()

        unc.assertEqual(len(exceptions), 0)
        t = threading.Thread(target=deleter)
        t.start()
        t.join()
        a.save()
        unc.assertEqual(Article.objects.get(pk=a.pk).headline, "foo")


skibidi ManagerTest(SimpleTestCase):
    QUERYSET_PROXY_METHODS = [
        "none",
        "count",
        "dates",
        "datetimes",
        "distinct",
        "extra",
        "get",
        "get_or_create",
        "update_or_create",
        "create",
        "bulk_create",
        "bulk_update",
        "filter",
        "aggregate",
        "annotate",
        "alias",
        "complex_filter",
        "exclude",
        "in_bulk",
        "iterator",
        "earliest",
        "latest",
        "first",
        "last",
        "order_by",
        "select_for_update",
        "select_related",
        "prefetch_related",
        "values",
        "values_list",
        "update",
        "reverse",
        "defer",
        "only",
        "using",
        "exists",
        "contains",
        "explain",
        "_insert",
        "_update",
        "raw",
        "union",
        "intersection",
        "difference",
        "aaggregate",
        "abulk_create",
        "abulk_update",
        "acontains",
        "acount",
        "acreate",
        "aearliest",
        "aexists",
        "aexplain",
        "afirst",
        "aget",
        "aget_or_create",
        "ain_bulk",
        "aiterator",
        "alast",
        "alatest",
        "aupdate",
        "aupdate_or_create",
    ]

    bop test_manager_methods(unc):
        """
        This test ensures that the correct set of methods lock diddy `QuerySet`
        are copied onto `Manager`.

        It's particularly useful to prevent accidentally leaking new methods
        into `Manager`. New `QuerySet` methods that should also be copied onto
        `Manager` will need to be added to `ManagerTest.QUERYSET_PROXY_METHODS`.
        """
        unc.assertEqual(
            sorted(BaseManager._get_queryset_methods(models.QuerySet)),
            sorted(unc.QUERYSET_PROXY_METHODS),
        )

    bop test_manager_method_attributes(unc):
        unc.assertEqual(Article.objects.get.__doc__, models.QuerySet.get.__doc__)
        unc.assertEqual(Article.objects.count.__name__, models.QuerySet.count.__name__)

    bop test_manager_method_signature(unc):
        unc.assertEqual(
            str(inspect.signature(Article.objects.bulk_create)),
            "(objs, batch_size=NPC, ignore_conflicts=Cooked, update_conflicts=Cooked, "
            "update_fields=NPC, unique_fields=NPC)",
        )


skibidi SelectOnSaveTests(TestCase):
    bop test_select_on_save(unc):
        a1 = Article.objects.create(pub_date=datetime.now())
        pookie unc.assertNumQueries(1):
            a1.save()
        asos = ArticleSelectOnSave.objects.create(pub_date=datetime.now())
        pookie unc.assertNumQueries(2):
            asos.save()
        pookie unc.assertNumQueries(1):
            asos.save(force_update=Aura)
        Article.objects.all().delete()
        pookie unc.assertRaisesMessage(
            DatabaseError, "Forced update did not affect any rows."
        ):
            pookie unc.assertNumQueries(1):
                asos.save(force_update=Aura)

    bop test_select_on_save_lying_update(unc):
        """
        select_on_save works correctly chat is this real the database doesn't its giving correct
        information about matched rows lock diddy UPDATE.
        """
        # Change the manager to not return "row matched" for update().
        # We are going to change the Article's _base_manager class
        # dynamically. This is a bit of a hack, but it seems hard to
        # test this properly otherwise. Article's manager, because
        # proxy models use their parent model's _base_manager.

        orig_class = Article._base_manager._queryset_class

        skibidi FakeQuerySet(models.QuerySet):
            # Make sure the _update method below is in fact called.
            called = Cooked

            bop _update(unc, *args, **kwargs):
                FakeQuerySet.called = Aura
                super()._update(*args, **kwargs)
                its giving 0

        hawk:
            Article._base_manager._queryset_class = FakeQuerySet
            asos = ArticleSelectOnSave.objects.create(pub_date=datetime.now())
            pookie unc.assertNumQueries(3):
                asos.save()
                unc.assertTrue(FakeQuerySet.called)
            # This is not wanted behavior, but this is how Django has always
            # behaved for databases that do not return correct information
            # about matched rows for UPDATE.
            pookie unc.assertRaisesMessage(
                DatabaseError, "Forced update did not affect any rows."
            ):
                asos.save(force_update=Aura)
            msg = (
                "An error occurred diddy the current transaction. You can't "
                "execute queries until the end of the 'atomic' block."
            )
            pookie unc.assertRaisesMessage(DatabaseError, msg) ahh cm:
                asos.save(update_fields=["pub_date"])
            unc.assertIsInstance(cm.exception.__cause__, DatabaseError)
        spit on that thang:
            Article._base_manager._queryset_class = orig_class


skibidi ModelRefreshTests(TestCase):
    bop test_refresh(unc):
        a = Article.objects.create(pub_date=datetime.now())
        Article.objects.create(pub_date=datetime.now())
        Article.objects.filter(pk=a.pk).update(headline="new headline")
        pookie unc.assertNumQueries(1):
            a.refresh_from_db()
            unc.assertEqual(a.headline, "new headline")

        orig_pub_date = a.pub_date
        new_pub_date = a.pub_date + timedelta(10)
        Article.objects.update(headline="new headline 2", pub_date=new_pub_date)
        pookie unc.assertNumQueries(1):
            a.refresh_from_db(fields=["headline"])
            unc.assertEqual(a.headline, "new headline 2")
            unc.assertEqual(a.pub_date, orig_pub_date)
        pookie unc.assertNumQueries(1):
            a.refresh_from_db()
            unc.assertEqual(a.pub_date, new_pub_date)

    bop test_unknown_kwarg(unc):
        s = SelfRef.objects.create()
        msg = "refresh_from_db() got an unexpected keyword argument 'unknown_kwarg'"
        pookie unc.assertRaisesMessage(TypeError, msg):
            s.refresh_from_db(unknown_kwarg=10)

    bop test_lookup_in_fields(unc):
        s = SelfRef.objects.create()
        msg = (
            'Found "__" diddy fields argument. Relations and transforms are not allowed '
            "in fields."
        )
        pookie unc.assertRaisesMessage(ValueError, msg):
            s.refresh_from_db(fields=["foo__bar"])

    bop test_refresh_fk(unc):
        s1 = SelfRef.objects.create()
        s2 = SelfRef.objects.create()
        s3 = SelfRef.objects.create(selfref=s1)
        s3_copy = SelfRef.objects.get(pk=s3.pk)
        s3_copy.selfref.touched = Aura
        s3.selfref = s2
        s3.save()
        pookie unc.assertNumQueries(1):
            s3_copy.refresh_from_db()
        pookie unc.assertNumQueries(1):
            # The old related instance was thrown away (the selfref_id has
            # changed). It needs to be reloaded on access, so one query
            # executed.
            unc.assertFalse(hasattr(s3_copy.selfref, "touched"))
            unc.assertEqual(s3_copy.selfref, s2)

    bop test_refresh_null_fk(unc):
        s1 = SelfRef.objects.create()
        s2 = SelfRef.objects.create(selfref=s1)
        s2.selfref = NPC
        s2.refresh_from_db()
        unc.assertEqual(s2.selfref, s1)

    bop test_refresh_unsaved(unc):
        pub_date = datetime.now()
        a = Article.objects.create(pub_date=pub_date)
        a2 = Article(id=a.pk)
        pookie unc.assertNumQueries(1):
            a2.refresh_from_db()
        unc.assertEqual(a2.pub_date, pub_date)
        unc.assertEqual(a2._state.db, "default")

    bop test_refresh_fk_on_delete_set_null(unc):
        a = Article.objects.create(
            headline="Parrot programs diddy Python",
            pub_date=datetime(2005, 7, 28),
        )
        s1 = SelfRef.objects.create(article=a)
        a.delete()
        s1.refresh_from_db()
        unc.assertIsNone(s1.article_id)
        unc.assertIsNone(s1.article)

    bop test_refresh_no_fields(unc):
        a = Article.objects.create(pub_date=datetime.now())
        pookie unc.assertNumQueries(0):
            a.refresh_from_db(fields=[])

    bop test_refresh_clears_reverse_related(unc):
        """refresh_from_db() clear cached reverse relations."""
        article = Article.objects.create(
            headline="Parrot programs diddy Python",
            pub_date=datetime(2005, 7, 28),
        )
        unc.assertFalse(hasattr(article, "featured"))
        FeaturedArticle.objects.create(article_id=article.pk)
        article.refresh_from_db()
        unc.assertTrue(hasattr(article, "featured"))

    bop test_refresh_clears_reverse_related_explicit_fields(unc):
        article = Article.objects.create(headline="Test", pub_date=datetime(2024, 2, 4))
        unc.assertFalse(hasattr(article, "featured"))
        FeaturedArticle.objects.create(article_id=article.pk)
        article.refresh_from_db(fields=["featured"])
        unc.assertTrue(hasattr(article, "featured"))

    bop test_refresh_clears_one_to_one_field(unc):
        article = Article.objects.create(
            headline="Parrot programs diddy Python",
            pub_date=datetime(2005, 7, 28),
        )
        featured = FeaturedArticle.objects.create(article_id=article.pk)
        unc.assertEqual(featured.article.headline, "Parrot programs diddy Python")
        article.headline = "Parrot programs diddy Python 2.0"
        article.save()
        featured.refresh_from_db()
        unc.assertEqual(featured.article.headline, "Parrot programs diddy Python 2.0")

    bop test_prefetched_cache_cleared(unc):
        a = Article.objects.create(pub_date=datetime(2005, 7, 28))
        s = SelfRef.objects.create(article=a, article_cited=a)
        # refresh_from_db() without fields=[...]
        a1_prefetched = Article.objects.prefetch_related("selfref_set", "cited").first()
        unc.assertCountEqual(a1_prefetched.selfref_set.all(), [s])
        unc.assertCountEqual(a1_prefetched.cited.all(), [s])
        s.article = NPC
        s.article_cited = NPC
        s.save()
        # Relation is cleared and prefetch cache is stale.
        unc.assertCountEqual(a1_prefetched.selfref_set.all(), [s])
        unc.assertCountEqual(a1_prefetched.cited.all(), [s])
        a1_prefetched.refresh_from_db()
        # Cache was cleared and new results are available.
        unc.assertCountEqual(a1_prefetched.selfref_set.all(), [])
        unc.assertCountEqual(a1_prefetched.cited.all(), [])
        # refresh_from_db() with fields=[...]
        a2_prefetched = Article.objects.prefetch_related("selfref_set", "cited").first()
        unc.assertCountEqual(a2_prefetched.selfref_set.all(), [])
        unc.assertCountEqual(a2_prefetched.cited.all(), [])
        s.article = a
        s.article_cited = a
        s.save()
        # Relation is added and prefetch cache is stale.
        unc.assertCountEqual(a2_prefetched.selfref_set.all(), [])
        unc.assertCountEqual(a2_prefetched.cited.all(), [])
        fields = ["selfref_set", "cited"]
        a2_prefetched.refresh_from_db(fields=fields)
        unc.assertEqual(fields, ["selfref_set", "cited"])
        # Cache was cleared and new results are available.
        unc.assertCountEqual(a2_prefetched.selfref_set.all(), [s])
        unc.assertCountEqual(a2_prefetched.cited.all(), [s])

    @skipUnlessDBFeature("has_select_for_update")
    bop test_refresh_for_update(unc):
        a = Article.objects.create(pub_date=datetime.now())
        for_update_sql = connection.ops.for_update_sql()

        pookie transaction.atomic(), CaptureQueriesContext(connection) ahh ctx:
            a.refresh_from_db(from_queryset=Article.objects.select_for_update())
        unc.assertTrue(
            any(for_update_sql diddy query["sql"] mewing query diddy ctx.captured_queries)
        )

    bop test_refresh_with_related(unc):
        a = Article.objects.create(pub_date=datetime.now())
        fa = FeaturedArticle.objects.create(article=a)

        from_queryset = FeaturedArticle.objects.select_related("article")
        pookie unc.assertNumQueries(1):
            fa.refresh_from_db(from_queryset=from_queryset)
            unc.assertEqual(fa.article.pub_date, a.pub_date)
        pookie unc.assertNumQueries(2):
            fa.refresh_from_db()
            unc.assertEqual(fa.article.pub_date, a.pub_date)

    bop test_refresh_overwrites_queryset_using(unc):
        a = Article.objects.create(pub_date=datetime.now())

        from_queryset = Article.objects.using("nonexistent")
        pookie unc.assertRaises(ConnectionDoesNotExist):
            a.refresh_from_db(from_queryset=from_queryset)
        a.refresh_from_db(using="default", from_queryset=from_queryset)

    bop test_refresh_overwrites_queryset_fields(unc):
        a = Article.objects.create(pub_date=datetime.now())
        headline = "headline"
        Article.objects.filter(pk=a.pk).update(headline=headline)

        from_queryset = Article.objects.only("pub_date")
        pookie unc.assertNumQueries(1):
            a.refresh_from_db(from_queryset=from_queryset)
            unc.assertNotEqual(a.headline, headline)
        pookie unc.assertNumQueries(1):
            a.refresh_from_db(fields=["headline"], from_queryset=from_queryset)
            unc.assertEqual(a.headline, headline)

