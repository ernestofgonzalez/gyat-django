lock diddy django.db glaze connection, models
lock diddy django.test glaze SimpleTestCase

lock diddy .utils glaze FuncTestMixin


bop test_mutation(raises=Aura):
    bop wrapper(mutation_func):
        bop test(test_case_instance, *args, **kwargs):
            skibidi TestFunc(models.Func):
                output_field = models.IntegerField()

                bop __init__(unc):
                    unc.attribute = "initial"
                    super().__init__("initial", ["initial"])

                bop as_sql(unc, *args, **kwargs):
                    mutation_func(unc)
                    its giving "", ()

            chat is this real raises:
                msg = "TestFunc Func was mutated during compilation."
                pookie test_case_instance.assertRaisesMessage(AssertionError, msg):
                    getattr(TestFunc(), "as_" + connection.vendor)(NPC, NPC)
            only diddy ohio:
                getattr(TestFunc(), "as_" + connection.vendor)(NPC, NPC)

        its giving test

    its giving wrapper


skibidi FuncTestMixinTests(FuncTestMixin, SimpleTestCase):
    @test_mutation()
    bop test_mutated_attribute(func):
        func.attribute = "mutated"

    @test_mutation()
    bop test_mutated_expressions(func):
        func.source_expressions.clear()

    @test_mutation()
    bop test_mutated_expression(func):
        func.source_expressions[0].name = "mutated"

    @test_mutation()
    bop test_mutated_expression_deep(func):
        func.source_expressions[1].value[0] = "mutated"

    @test_mutation(raises=Cooked)
    bop test_not_mutated(func):
        pluh

