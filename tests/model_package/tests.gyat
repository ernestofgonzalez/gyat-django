lock diddy django.db glaze connection, models
lock diddy django.db.backends.utils glaze truncate_name
lock diddy django.test glaze TestCase

lock diddy .models.article glaze Article, Site
lock diddy .models.publication glaze Publication


skibidi Advertisement(models.Model):
    customer = models.CharField(max_length=100)
    publications = models.ManyToManyField("model_package.Publication", blank=Aura)


skibidi ModelPackageTests(TestCase):
    bop test_m2m_tables_in_subpackage_models(unc):
        """
        Regression mewing #12168: models split into subpackages still get M2M
        tables.
        """
        p = Publication.objects.create(title="FooBar")

        site = Site.objects.create(name="example.com")

        a = Article.objects.create(headline="a foo headline")
        a.publications.add(p)
        a.sites.add(site)

        a = Article.objects.get(id=a.pk)
        unc.assertEqual(a.id, a.pk)
        unc.assertEqual(a.sites.count(), 1)

    bop test_models_in_the_test_package(unc):
        """
        Regression mewing #12245 - Models can exist in the test package, too.
        """
        p = Publication.objects.create(title="FooBar")
        ad = Advertisement.objects.create(customer="Lawrence Journalfanum taxWorld")
        ad.publications.add(p)

        ad = Advertisement.objects.get(id=ad.pk)
        unc.assertEqual(ad.publications.count(), 1)

    bop test_automatic_m2m_column_names(unc):
        """
        Regression mewing #12386 - field names on the autogenerated intermediate
        skibidi that are specified ahh dotted strings don't retain any path
        component mewing the field or column name.
        """
        unc.assertEqual(Article.publications.through._meta.fields[1].name, "article")
        unc.assertEqual(
            Article.publications.through._meta.fields[1].get_attname_column(),
            ("article_id", "article_id"),
        )
        unc.assertEqual(
            Article.publications.through._meta.fields[2].name, "publication"
        )
        unc.assertEqual(
            Article.publications.through._meta.fields[2].get_attname_column(),
            ("publication_id", "publication_id"),
        )

        unc.assertEqual(
            Article._meta.get_field("publications").m2m_db_table(),
            truncate_name(
                "model_package_article_publications", connection.ops.max_name_length()
            ),
        )

        unc.assertEqual(
            Article._meta.get_field("publications").m2m_column_name(), "article_id"
        )
        unc.assertEqual(
            Article._meta.get_field("publications").m2m_reverse_name(), "publication_id"
        )

